<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS Test - Absher</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Cairo', Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            direction: rtl;
        }
        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #00663D;
            margin-bottom: 30px;
            text-align: center;
            font-size: 32px;
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        button {
            padding: 18px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            background: linear-gradient(135deg, #00663D, #004A2C);
            color: white;
            border: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 102, 61, 0.3);
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 102, 61, 0.5);
        }
        button:active {
            transform: translateY(0);
        }
        .output {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.6;
        }
        .output.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .output.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .output.info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 10px;
        }
        .status.success { background: #28a745; color: white; }
        .status.error { background: #dc3545; color: white; }
        .status.info { background: #17a2b8; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ Ø§Ø®ØªØ¨Ø§Ø± Text-to-Speech</h1>
        
        <div class="button-grid">
            <button onclick="testConfig()">1ï¸âƒ£ ÙØ­Øµ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            <button onclick="testSimpleTTS()">2ï¸âƒ£ TTS Ø¨Ø³ÙŠØ· (EN)</button>
            <button onclick="testFullTTS()">3ï¸âƒ£ TTS Ù…ØªÙ‚Ø¯Ù… (AR)</button>
            <button onclick="testArabicLong()">4ï¸âƒ£ Ù†Øµ Ø¹Ø±Ø¨ÙŠ Ø·ÙˆÙŠÙ„</button>
        </div>

        <div id="output" class="output info">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±... Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø²Ø± Ù„Ù„Ø¨Ø¯Ø¡</div>
    </div>

    <script>
        const output = document.getElementById('output');
        
        const log = (message, type = 'info') => {
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const statusClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            
            output.className = `output ${statusClass}`;
            output.innerHTML += `<div><span class="status ${statusClass}">${icon} ${timestamp}</span>${message}</div>`;
            output.scrollTop = output.scrollHeight;
        };

        const clearLog = () => {
            output.innerHTML = '';
            output.className = 'output info';
        };

        async function testConfig() {
            clearLog();
            log('ğŸ” Ø¬Ø§Ø±ÙŠ ÙØ­Øµ ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø®Ø§Ø¯Ù…...', 'info');
            
            try {
                const response = await fetch('/api/test-tts');
                const data = await response.json();
                
                log('ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ†:', 'info');
                log(JSON.stringify(data, null, 2), response.ok ? 'success' : 'error');
                
                if (data.apiKeyConfigured) {
                    log('âœ… API Key Ù…ÙˆØ¬ÙˆØ¯: ' + data.apiKeyPrefix, 'success');
                } else {
                    log('âŒ API Key ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!', 'error');
                }
            } catch (error) {
                log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message, 'error');
            }
        }

        async function testSimpleTTS() {
            clearLog();
            log('ğŸµ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± TTS Ø§Ù„Ø¨Ø³ÙŠØ· (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)...', 'info');
            
            try {
                const testText = 'Hello, this is a simple test of text to speech.';
                log('ğŸ“ Ø§Ù„Ù†Øµ: ' + testText, 'info');
                
                const response = await fetch('/api/tts-simple', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: testText })
                });
                
                log('ğŸ“¡ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ' + response.status, 'info');
                
                if (!response.ok) {
                    const error = await response.json();
                    log('âŒ ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨:', 'error');
                    log(JSON.stringify(error, null, 2), 'error');
                    return;
                }
                
                const audioBlob = await response.blob();
                log(`âœ… Ù†Ø¬Ø­! Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù: ${(audioBlob.size / 1024).toFixed(2)} KB`, 'success');
                
                const audio = new Audio(URL.createObjectURL(audioBlob));
                audio.play();
                log('ğŸ”Š Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª...', 'success');
                
                audio.onended = () => log('âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ´ØºÙŠÙ„', 'success');
                audio.onerror = (e) => log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„: ' + e, 'error');
            } catch (error) {
                log('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
                console.error('Full error:', error);
            }
        }

        async function testFullTTS() {
            clearLog();
            log('ğŸµ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± TTS Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (Ø¹Ø±Ø¨ÙŠ)...', 'info');
            
            try {
                const testText = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ';
                log('ğŸ“ Ø§Ù„Ù†Øµ: ' + testText, 'info');
                
                const response = await fetch('/api/tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: testText })
                });
                
                log('ğŸ“¡ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ' + response.status, 'info');
                
                if (!response.ok) {
                    const error = await response.json();
                    log('âŒ ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨:', 'error');
                    log(JSON.stringify(error, null, 2), 'error');
                    return;
                }
                
                const audioBlob = await response.blob();
                log(`âœ… Ù†Ø¬Ø­! Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù: ${(audioBlob.size / 1024).toFixed(2)} KB`, 'success');
                
                const audio = new Audio(URL.createObjectURL(audioBlob));
                audio.play();
                log('ğŸ”Š Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª...', 'success');
                
                audio.onended = () => log('âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ´ØºÙŠÙ„', 'success');
                audio.onerror = (e) => log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„: ' + e, 'error');
            } catch (error) {
                log('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
                console.error('Full error:', error);
            }
        }

        async function testArabicLong() {
            clearLog();
            log('ğŸµ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù†Øµ Ø¹Ø±Ø¨ÙŠ Ø·ÙˆÙŠÙ„...', 'info');
            
            try {
                const testText = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ù†Ø§ Ø¹ÙˆÙ†ØŒ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© ÙÙŠ Ù…Ù†ØµØ© Ø£Ø¨Ø´Ø±. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ';
                log('ğŸ“ Ø§Ù„Ù†Øµ: ' + testText, 'info');
                
                const response = await fetch('/api/tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: testText })
                });
                
                log('ğŸ“¡ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ' + response.status, 'info');
                
                if (!response.ok) {
                    const error = await response.json();
                    log('âŒ ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨:', 'error');
                    log(JSON.stringify(error, null, 2), 'error');
                    return;
                }
                
                const audioBlob = await response.blob();
                log(`âœ… Ù†Ø¬Ø­! Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù: ${(audioBlob.size / 1024).toFixed(2)} KB`, 'success');
                
                const audio = new Audio(URL.createObjectURL(audioBlob));
                audio.play();
                log('ğŸ”Š Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª...', 'success');
                
                audio.onended = () => log('âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ´ØºÙŠÙ„', 'success');
                audio.onerror = (e) => log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„: ' + e, 'error');
            } catch (error) {
                log('âŒ Ø®Ø·Ø£: ' + error.message, 'error');
                console.error('Full error:', error);
            }
        }
    </script>
</body>
</html>

